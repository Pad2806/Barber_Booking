
≡ƒº¬ ===== PAYMENT FLOW TEST =====

≡ƒô¥ Step 1: Login as admin...
Γ£à Login successful, got token

≡ƒô¥ Step 2: Get salon list...
Γ£à Found salon: Reetro Quß║¡n 1 (ID: 87a8841e-f648-47db-b041-abd068b374d2)

≡ƒô¥ Step 3: Get services for salon...
Γ£à Found service: Cß║»t t├│c nam - 100000─æ

≡ƒô¥ Step 4: Get staff for salon...
Γ£à Found staff: Minh Barber

≡ƒô¥ Step 5: Create booking...
   Checking available slots for 2026-02-06...
   Found 25 available slots, using: 08:00
Γ£à Created booking: RBML94YTV221
   - Date: 2026-02-06T00:00:00.000Z
   - Time: 08:00
   - Amount: 100000─æ

≡ƒô¥ Step 6: Create VietQR payment...
Γ£à Created payment:
   - Payment ID: b9ead0a4-9ba6-4431-8c98-2ca6c0b68905
   - Method: VIETQR
   - Status: PENDING
   - QR Code URL: https://img.vietqr.io/image/970422-0123456789-compact2.png?amount=100000&addInfo...
   - Bank: 970422 - 0123456789

≡ƒô¥ Step 7: Check payment status (before webhook)...
Γ£à Payment status: PENDING (should be PENDING)

≡ƒô¥ Step 8: Simulate Sepay webhook callback...
   Webhook payload: {
  "id": "SEPAY1770276578278",
  "gateway": "MBBank",
  "transactionDate": "2026-02-05 07:29:38",
  "accountNumber": "0123456789",
  "subAccount": null,
  "transferType": "in",
  "transferAmount": 100000,
  "accumulated": 100000,
  "code": null,
  "content": "RBML94YTV221 thanh toan",
  "referenceCode": "FT1770276578278",
  "description": "MBVCB.1770276578278.RBML94YTV221 thanh toan.CT tu 0901234567"
}
   Webhook response: {"message":"Invalid webhook signature","error":"Unauthorized","statusCode":401}
Γ£à Webhook processed: Invalid webhook signature

≡ƒô¥ Step 9: Check payment status (after webhook)...
Γ£à Final payment status: PENDING
   - Paid at: Not paid
   - Sepay Trans ID: N/A

≡ƒô¥ Step 10: Check booking payment status...
Γ£à Booking payment status: UNPAID

===== TEST SUMMARY =====

Γ£à Login: PASSED
   Data: {"hasToken":true}
Γ£à Get Salons: PASSED
   Data: {"salonName":"Reetro Quß║¡n 1"}
Γ£à Get Services: PASSED
   Data: {"serviceName":"Cß║»t t├│c nam","price":"100000"}
Γ£à Get Staff: PASSED
   Data: {"staffId":"63b657cf-6d5c-4fc0-ac02-3efbb7ee9b91"}
Γ£à Create Booking: PASSED
   Data: {"bookingCode":"RBML94YTV221","amount":"100000"}
Γ£à Create Payment: PASSED
   Data: {"paymentId":"b9ead0a4-9ba6-4431-8c98-2ca6c0b68905","hasQRCode":true,"status":"PENDING"}
Γ£à Check Payment Before: PASSED
   Data: {"status":"PENDING"}
Γ¥î Sepay Webhook: FAILED
   Data: {"message":"Invalid webhook signature","error":"Unauthorized","statusCode":401}
Γ£à Check Payment After: PASSED
   Data: {"status":"PENDING","isPaid":false,"paidAt":null}
Γ£à Check Booking After: PASSED
   Data: {"bookingStatus":"PENDING","paymentStatus":"UNPAID"}

≡ƒôè Results: 9/10 passed, 1 failed

ΓÜá∩╕Å  Some tests failed. Please check the errors above.

